<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Panel del Administrador</title>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Document</title>
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
            crossorigin="anonymous"
            />
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
            />
        <link rel="stylesheet" type="text/css" th:href="@{/css/globales.css}" />
        <link rel="stylesheet" type="text/css" th:href="@{/css/style-dashboard.css}" />
        <link rel="stylesheet" type="text/css" th:href="@{/css/normalize.css}" />
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@200;400;700&display=swap"
            rel="stylesheet"
            />
        <script defer src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
        <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
        <script defer src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script defer src="/js/script_dashboard.js"></script>
    </head>
    <body>
        <header class="contenedor-header">
            <nav th:replace = "~{/fragments/navbar2 :: nav}"></nav>
            <div th:replace = "~{/fragments/modelo :: div}"></div>
        </header>
        <div class="container">
            <nav class="sidebar">
                <a href="#projectsSection" onclick="showSection('projects')">Gestión de Proyectos</a>
                <a href="#agentsSection" onclick="showSection('agents')">Gestión de Usuarios</a>
                <a href="#clientsSection" onclick="showSection('clients')">Gestión de Empresas</a>
                <a href="#adminDashboardSection" onclick="showSection('adminDashboard')"
                   >Dashboard del Administrador</a
                >
            </nav>

            <div class="content">
                <!--**********************************************************************************************-->
                <!--SECCION PROYECTOS-->
                <div id="projectsSection" class="content-section">
                    <h1>Gestión de Proyectos</h1>
                    <section class="text-center">
                        <form id="formBusquedaProyecto" th:action="@{/admin/buscar}" method="post" class="form-inline justify-content-center mb-2">
                            <!-- Cambia el método de GET a POST -->
                            <input
                                type="text"
                                id="nombreProyecto"
                                th:value="${nombreProyecto}"
                                name="nombreProyecto"
                                class="form-control input-empresa"
                                placeholder="Buscar por nombre del proyecto"
                                oninput="mostrarSugerencias(this.value)"
                                />

                            <!-- Agrego el div con las sugerencias -->
                            <div
                                id="sugerenciasProyectos"
                                class="sugerencias-proyectos"
                                style="display: none"
                                >
                                <ul onclick="seleccionarSugerencia(event)">
                                    <!-- Lista de sugerencias -->
                                </ul>
                            </div>

                            <!-- Cambia el tipo de botón a submit y agrega un id -->
                            <button type="submit" id="buscarButton">Buscar</button>
                        </form>
                    </section>


                    <!-- Contenido específico para la gestión de proyectos -->
                    <div id="empresasContainer" class="resultados mt-4 input-empresa-otro">
                        <h2>Empresas Asociadas</h2>

                        <div
                            th:if="${empresas != null and !empresas.isEmpty()}"
                            class="input-empresa-otro"
                            >
                            <ul>
                                <!-- Lista de empresas -->
                                <li
                                    th:each="empresa : ${empresas}"
                                    th:text="${empresa}"
                                    style="border-bottom: 3px double white"
                                    >
                                    Nombre de la Empresa
                                </li>
                            </ul>
                        </div>
                        <div
                            th:if="${empresas == null or empresas.isEmpty()}"
                            class="alert alert-info"
                            style="border: 2px solid var(--fondo)"
                            >
                            No se encontraron empresas asociadas al proyecto.
                        </div>
                    </div>
                    <div id="usuariosContainer" class="resultados mt-4 input-empresa-otro">
                        <h2>Usuarios Asociados</h2>

                        <div
                            th:if="${usuarios != null and !usuarios.isEmpty()}"
                            class="input-empresa-otro"
                            >
                            <ul>
                                <li th:each="usuario : ${usuarios}">
                                    <span th:if="${usuario != null and usuario.getClass().getName() == 'java.lang.String'}" th:text="${usuario}"></span>
                                    <span th:if="${usuario != null and usuario.getClass().getName() != 'java.lang.String'}">
                                        <span th:text="${usuario.nombre != null ? usuario.nombre : ''}"></span>
                                        <span th:text="${usuario.apellido != null ? ' ' + usuario.apellido : ''}"></span>
                                        <span th:text="${usuario.rol != null ? '(' + usuario.rol + ')' : ''}"></span>
                                    </span>
                                </li>
                            </ul>
                        </div>
                        <div
                            th:if="${usuarios == null or usuarios.isEmpty()}"
                            class="alert alert-info"
                            style="border: 2px solid var(--fondo)"
                            >
                            No se encontraron usuarios asociados al proyecto.
                        </div>
                    </div>

                    <div id="reunionesContainer" class="resultados mt-4 input-empresa-otro">
                        <h2>Reuniones del Proyecto</h2>

                        <div th:if="${reuniones != null and not #lists.isEmpty(reuniones)}" class="input-empresa-otro">
                            <ul>
                                <li th:each="reunion : ${reuniones}">
                                    <span th:if="${reunion != null and reunion.getClass().getName() == 'java.lang.String'}" th:text="${reunion}"></span>
                                    <span th:if="${reunion != null and reunion.getClass().getName() != 'java.lang.String'}">
                                        <span th:text="${reunion.nombre != null ? reunion.nombre : ''}"></span>
                                        <span th:text="${reunion.horarioDeInicioFormatt != null ? ' ' + reunion.horarioDeInicioFormatt : ''}"></span>
                                        <span th:text="${reunion.progreso != null ? '(' + reunion.progreso + ')' : ''}"></span>
                                    </span>
                                </li>
                            </ul>
                        </div>
                        <div th:if="${reuniones == null or #lists.isEmpty(reuniones)}" class="alert alert-info" style="border: 2px solid var(--fondo)">
                            No se encontraron reuniones asociadas al proyecto.
                        </div>
                    </div>
                    <div id="tareasContainer" class="resultados mt-4 input-empresa-otro">
                        <h2>Tareas del Proyecto</h2>

                        <div
                            th:if="${tareas != null and !tareas.isEmpty()}"
                            class="input-empresa-otro"
                            >
                            <ul>
                                <li th:each="tarea : ${tareas}">
                                    <span th:if="${tarea != null and tarea.getClass().getName() == 'java.lang.String'}" th:text="${tarea}"></span>
                                    <span th:if="${tarea != null and tarea.getClass().getName() != 'java.lang.String'}">
                                        <span th:text="${tarea.nombreTarea != null ? tarea.nombreTarea : ''}"></span>
                                        <span th:text="${tarea.fechaInicioFormatt != null ? ' ' + tarea.fechaInicioFormatt : ''}"></span>
                                        <span th:text="${tarea.progreso != null ? '(' + tarea.progreso + ')' : ''}"></span>
                                    </span>
                                </li>
                            </ul>
                        </div>
                        <div
                            th:if="${tareas == null or tareas.isEmpty()}"
                            class="alert alert-info"
                            style="border: 2px solid var(--fondo)"
                            >
                            No se encontraron tareas asociadas al proyecto.
                        </div>
                    </div>
                </div>
                <!--**********************************************************************************************-->
                <!--**********************************************************************************************-->
                <!-- SECCION USUARIOS -->
                <div id="agentsSection" class="content-section">
                    <h1>Gestión de Usuarios</h1>

                    <!-- Iterar sobre la lista de usuarios -->
                    <div th:each="usuario : ${listaUsuarios}" class="agent-card">
                        <div class="agent-card-datos">
                            <img th:src="'data:image/' + ${usuario.imagen.mime} + ';base64,' + ${usuario.imagen.base64Image}" alt="Foto del Usuario" />
                            <h4 th:text="${usuario.nombre + ' ' + usuario.apellido}"></h4>
                            <p th:text="'Email: ' + ${usuario.email}"></p>
                            <p th:text="'Rol: ' + ${usuario.rol}"></p>
                            <p th:text="'Empresa: ' + ${usuario.empresa}"></p>

                            <!-- Dentro de la card del agente -->
                            <div class="agent-card-buttons" style="text-align: right">
                                <a class="modificar" th:href="@{/perfil/panel/__${usuario.id}__}"
                                   ><i class="fas fa-feather-alt"></i> Modificar</a>
                                <button type="button" th:attr="data-userid=${usuario.id}" onclick="showDetails(this.getAttribute('data-userid'))">Ver Más</button>
                            </div>
                        </div>

                        <!-- Agregar este div oculto al final de tu HTML fuera de las tarjetas -->
                        <div th:id="'detailsSection-' + ${usuario.id}" class="detailsSection" style="display: none;">
                            <div class="agent-card-extra">
                                <!-- Contenido detallado del agente (proyectos, tareas, reuniones, etc.) -->
                                <!-- Contenido detallado del agente (proyectos, tareas, reuniones, etc.) -->
                                <h4>Proyectos</h4>
                                <p th:if="${proyectosTotales != null}" th:text="'Proyectos Totales: ' + ${proyectosTotales}"></p>
                                <p th:if="${proyectosEnProgreso != null}" th:text="'Proyectos Pendientes: ' + ${proyectosEnProgreso}"></p>
                                <p th:if="${proyectosFinalizados != null}" th:text="'Proyectos Finalizados: ' + ${proyectosFinalizados}"></p>
                                <h4>Reuniones</h4>
                                <p th:if="${reunionesTotales != null}" th:text="'Reuniones Totales: ' + ${reunionesTotales}"></p>
                                <p th:if="${reunionesEnProgreso != null}" th:text="'Reuniones Pendientes: ' + ${reunionesEnProgreso}"></p>
                                <p th:if="${reunionesFinalizados != null}" th:text="'Reuniones Finalizados: ' + ${reunionesFinalizados}"></p>
                                <h4>Tareas</h4>
                                <p th:if="${tareasTotales != null}" th:text="'Tareas Totales: ' + ${tareasTotales}"></p>
                                <p th:if="${tareasEnProgreso != null}" th:text="'Tareas Pendientes: ' + ${tareasEnProgreso}"></p>
                                <p th:if="${tareasFinalizados != null}" th:text="'Tareas Finalizados: ' + ${tareasFinalizados}"></p>

                                <!-- Agregar el botón "Ver Menos" -->
                                <button onclick="hideDetails()">Ver Menos</button>
                            </div>
                        </div>
                    </div>
                </div>
                <!--**********************************************************************************************-->
                <!-- SECCION EMPRESAS -->
                <div id="clientsSection" class="content-section">
                    <h1>Gestión de Empresas</h1>
                    <section class="text-center" style="margin-top: 4rem">
                        <form
                            th:action="@{/admin/buscarUsuarioYProyectos}"
                            method="get"
                            class="form-inline justify-content-center mb-2"
                            >
                            <!-- Agrego el campo de autocompletar para el nombre de la empresa -->
                            <div class="autocomplete">
                                <input
                                    type="text"
                                    id="nombreEmpresa"
                                    name="nombreEmpresa"
                                    class="form-control input-empresa"
                                    placeholder="Buscar por nombre de la empresa"
                                    oninput="mostrarSugerenciasEmpresa(this.value)"
                                    />

                                <div
                                    id="sugerenciasEmpresas"
                                    class="sugerencias-proyectos"
                                    style="display: none"
                                    ></div>
                            </div>
                            <button type="submit" class="btn-buscar">
                                Buscar por nombre Empresa
                            </button>
                        </form>
                    </section>
                    <div class="resultados mt-4 input-empresa-otro">
                        <h2>Usuarios Asociados</h2>

                        <div
                            th:if="${listadoUsuarios != null and !listadoUsuarios.isEmpty()}"
                            >
                            <ul>
                                <li th:each="usuario : ${listadoUsuarios}">
                                    <span th:if="${usuario != null and usuario.getClass().getName() == 'java.lang.String'}" th:text="${usuario}"></span>
                                    <span th:if="${usuario != null and usuario.getClass().getName() != 'java.lang.String'}">
                                        <span th:text="${usuario.nombre != null ? usuario.nombre : ''}"></span>
                                        <span th:text="${usuario.apellido != null ? ' ' + usuario.apellido : ''}"></span>
                                        <span th:text="${usuario.rol != null ? '(' + usuario.rol + ')' : ''}"></span>
                                    </span>
                                </li>
                            </ul>
                        </div>
                        <div
                            th:if="${listadoUsuarios == null or listadoUsuarios.isEmpty()}"
                            class="alert alert-info"
                            style="border: 2px solid var(--fondo)"
                            >
                            No se encontraron usuarios asociados al proyecto.
                        </div>
                    </div>
                    <!-- Sección de Proyectos -->
                    <div class="resultados mt-4 input-empresa-otro" id="proyectosAsociadosContainer">
                        <h2>Proyectos Asociados</h2>
                        <!-- Lista de Proyectos -->
                        <div th:if="${proyectos != null and !proyectos.isEmpty()}">
                            <ul>
                                <li th:each="proyecto : ${proyectos}" th:text="${proyecto.nombre + ' //Fecha De Inicio: ' + proyecto.fechaInicio + '(' + proyecto.progreso + ')'}" >Nombre del Proyecto</li>
                            </ul>
                        </div>
                        <div th:if="${proyectos == null or proyectos.isEmpty()}" class="alert alert-info" style="border: 2px solid var(--fondo)">
                            No se encontraron proyectos asociados a la empresa.
                        </div>
                    </div>

                </div>

                <!--**********************************************************************************************-->
                <!--SECCION DASHBOARD-->
                <div id="adminDashboardSection" class="content-section">
                    <h1>Dashboard del Administrador</h1>
                    <!-- Contenido específico para el dashboard del administrador -->
                    <!-- Métricas clave -->
                    <div>
                        <h3>Métricas Clave</h3>
                        <!-- Agrega aquí las métricas clave -->
                        <p>Total de Proyectos: <span id="totalProjects">25</span></p>
                        <p>Total de Clientes: <span id="totalClients">15</span></p>
                        <!-- Agrega más métricas según sea necesario -->
                    </div>

                    <!-- Gráficos -->
                    <div>
                        <h3>Gráficos</h3>

                        <!-- Gráfico de carga de trabajo de los agentes -->
                        <canvas id="workloadChart" width="400" height="200"></canvas>

                        <!-- Gráfico de estado de los proyectos -->
                        <canvas id="projectStatusChart" width="400" height="200"></canvas>
                    </div>

                    <!-- Estadísticas sobre el estado de los proyectos y su progreso -->
                    <div>
                        <h3>Estadísticas de Proyectos</h3>
                        <!-- Agrega aquí estadísticas detalladas sobre el estado y progreso de los proyectos -->
                        <p>Proyectos Pendientes: <span id="pendingProjects">8</span></p>
                        <p>
                            Proyectos en Progreso: <span id="inProgressProjects">10</span>
                        </p>
                        <p>Proyectos Completados: <span id="completedProjects">7</span></p>
                    </div>

                    <!-- Información resumida sobre clientes y proyectos -->
                    <div>
                        <h3>Información Resumida</h3>
                        <!-- Agrega aquí información resumida sobre clientes y proyectos -->
                        <p>Clientes Activos: <span id="activeClients">12</span></p>
                        <p>Proyectos Recientes: <span id="recentProjects">5</span></p>
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>

